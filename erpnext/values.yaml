# values.yaml for ERPNext Helm Chart (clean + fixed)
# No Bitnami dependencies, avoids nil pointers

image:
  repository: frappe/erpnext
  tag: v15.0.0
  pullPolicy: IfNotPresent

worker:
  default:
    replicaCount: 1
    autoscaling:
      enabled: false
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
    livenessProbe:
      httpGet:
        path: /api/method/ping
        port: 8000
      initialDelaySeconds: 30
      periodSeconds: 20
    readinessProbe:
      httpGet:
        path: /api/method/ping
        port: 8000
      initialDelaySeconds: 10
      periodSeconds: 10

  short:
    replicaCount: 1
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
    livenessProbe:
      exec:
        command: ["pgrep", "-f", "celery.*short"]
      initialDelaySeconds: 30
      periodSeconds: 20
    readinessProbe:
      exec:
        command: ["pgrep", "-f", "celery.*short"]
      initialDelaySeconds: 10
      periodSeconds: 10

  long:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "300m"
      limits:
        memory: "1Gi"
        cpu: "500m"
    livenessProbe:
      exec:
        command: ["pgrep", "-f", "celery.*long"]
      initialDelaySeconds: 120
      periodSeconds: 30
    readinessProbe:
      exec:
        command: ["pgrep", "-f", "celery.*long"]
      initialDelaySeconds: 60
      periodSeconds: 20
    affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values: [worker-long]
            topologyKey: kubernetes.io/hostname

  scheduler:
    replicaCount: 1
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
    livenessProbe:
      exec:
        command: ["pgrep", "-f", "celery.*scheduler"]
      initialDelaySeconds: 30
      periodSeconds: 20
    readinessProbe:
      exec:
        command: ["pgrep", "-f", "celery.*scheduler"]
      initialDelaySeconds: 10
      periodSeconds: 10

  gunicorn:
    service:
      type: ClusterIP
      port: 8000
    replicaCount: 1
    image:
      repository: frappe/erpnext
      tag: v15.0.0
      pullPolicy: IfNotPresent
    resources:
      requests:
        cpu: "300m"
        memory: "512Mi"
      limits:
        cpu: "1"
        memory: "1Gi"
    livenessProbe:
      httpGet:
        path: /api/method/ping
        port: 8000
      initialDelaySeconds: 30
      periodSeconds: 15
    readinessProbe:
      httpGet:
        path: /api/method/ping
        port: 8000
      initialDelaySeconds: 15
      periodSeconds: 10
